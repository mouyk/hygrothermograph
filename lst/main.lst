C51 COMPILER V9.60.0.0   MAIN                                                              06/24/2023 12:55:00 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE source\main.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\include;.\sou
                    -rce;.\include) DEBUG PRINT(.\lst\main.lst) TABS(2) OBJECT(.\output\main.obj)

line level    source

   1          
   2          #ifndef _MAIN_C_
   3          #define _MAIN_C_
   4          /*********************************************************************************************************
             -************/
   5          #include "include/ca51f_config.h"   
   6          #include "include/ca51f2sfr.h"
   7          #include "include/ca51f2xsfr.h"
   8          #include "include/gpiodef_f2.h"
   9          #include "include/system_clock.h"
  10          
  11          #include "include/uart.h"
  12          #include "include/lcd_led.h"
  13          #include "include/delay.h"
  14          #include "include/lcd.h"
*** WARNING C318 IN LINE 14 OF source\main.c: can't open file 'include/lcd.h'
  15          #include "include/gpio.h"
  16          #include "include/gxhtc.h"
  17          #include "include/rtc.h"
  18          #include <intrins.h>
  19          #include "include/pwm.h"
  20          
  21          
  22          /*********************************************************************************************************
             -************      
  23            本例程实现4com*9seg、1/3bias LCD显示功能，LCD时钟设置为XOSCL或IRCL，实现LCD最小电流模式。
  24            
  25            重要提示：
  26            在关闭LCD功能前，把所设置的COM脚和SEG脚设置为输出模式并输出低电平，可以避免关闭LCD功能时LCD屏出现拖影现象
             -。
  27          **********************************************************************************************************
             -***********/      
  28          extern uint8_t key_value;
  29          
  30          void main(void)
  31          {
  32   1      extern float GXHTC3_temp,GXHTC3_humi;
  33   1      extern bit HalfSecFlag;
  34   1      extern bit AlarmEvFlag; 
  35   1        unsigned char i;
  36   1        uint8_t ab = 0;
  37   1        uint16_t times = 0;
  38   1        uint16_t a,b,c,d,e,f,g=0;
  39   1      #ifdef LVD_RST_ENABLE
  40   1        LVDCON = 0xE1;          //设置LVD复位电压为2V
  41   1      #endif  
  42   1        
  43   1      #if (SYSCLK_SRC == PLL)
                Sys_Clk_Set_PLL(PLL_Multiple);  //设置系统时钟为PLL，PLL_Multiple为倍频倍数
              #endif
  46   1        
  47   1      #ifdef UART0_EN
                Uart0_Initial(UART0_BAUTRATE);  //初始化UART0
              #endif
C51 COMPILER V9.60.0.0   MAIN                                                              06/24/2023 12:55:00 PAGE 2   

  50   1        
  51   1      #ifdef UART1_EN
  52   1        Uart1_Initial(UART1_BAUTRATE);  //初始化UART1
  53   1      #endif
  54   1      
  55   1      #ifdef UART2_EN
                Uart2_Initial(UART2_BAUTRATE);  //初始化UART2
              #endif
  58   1      
  59   1        EA = 1;                         //开全局中断
  60   1      
  61   1      #ifdef PRINT_EN
  62   1        uart_printf("LCD Power Saving Mode Demo Code\n");
  63   1      #endif
  64   1      
  65   1        
  66   1      //  P72F = P72_XOSCL_IN_SETTING;      //设置P72为晶振引脚
  67   1      //  P71F = P71_XOSCL_OUT_SETTING;     //设置P71为晶振引脚
  68   1      //  CKCON |= XLCKE;             //使能XSOCL
  69   1      //  while(!(CKCON & XLSTA));        //等待XSOCL稳定
  70   1      //  
  71   1      ////  CKCON |= ILCKE;             //使能IRCL
  72   1      
  73   1      //  LXDIVH = 0;       //设置LCD时钟分频，目标帧频率为64HZ
  74   1      //  LXDIVL = 0; 
  75   1      //  LXCAD = 0;
  76   1      //  LXCFG =  DMOD(DMOD_5ua) | BIAS(BIAS_1_3) | LDRV(LDRV_7);      //设置LCD驱动电流、偏压(bias)、辉度
  77   1      //  LXCON =  LEN(LEN_XOSCL) | LMOD(LMOD_lcd);             //设置LCD时钟源为XOSCL，选择LCD模式
  78   1      ////  LXCON =  LEN(LEN_IRCL) | LMOD(LMOD_lcd);              //设置LCD时钟源为IRCL，选择LCD模式
  79   1      //  
  80   1      //  //设置LCD全显
  81   1      //  for(i = 0; i < 9; i++)
  82   1      //  {
  83   1      //    INDEX = i;
  84   1      //    LXDAT = 0xFF;
  85   1      //  }
  86   1      
  87   1      ////  LCD_Off();
  88   1      //  
  89   1      //  I2CCON = 0;           //关闭I2C，否则系统时钟无法关闭
  90   1      //  CKCON = XLCKE;          //关闭除LCD时钟外的其他时钟
  91   1      ////  CKCON = ILCKE;  
  92   1      //  PWCON &= ~0x08;         //LDO进入低功率模式
  93   1      //  
  94   1      //  PCON = (PCON&0x84) | 0x02;      //进入STOP模式
  95   1      //  _nop_();
  96   1      //  _nop_();
  97   1      //  _nop_();
  98   1      GXHTC3_INIT();  
  99   1      PWM6_init();
 100   1      GPIO_init();
 101   1      INT2_Init();
 102   1      INT3_Init();
 103   1      INT4_Init();
 104   1      INT5_Init();
 105   1      RTC_init();
 106   1      
 107   1      RTC_Set(2023,6,17,14,37,0);
 108   1      
 109   1        while(1)
 110   1        {
 111   2      //      get_gxth30(); 
C51 COMPILER V9.60.0.0   MAIN                                                              06/24/2023 12:55:00 PAGE 3   

 112   2      //    PWMEN  = (1<<PWM_CH6);    //PWM6使能    
 113   2      //    Delay_ms(10);
 114   2      //    PWMEN  = ~(1<<PWM_CH6);   //PWM6禁用  
 115   2      //    Delay_ms(1000);   
 116   2          if(40==key_value)
 117   2          {
 118   3            if(P40 == 0)
 119   3            {
 120   4              times++;
 121   4            }
 122   3            else
 123   3            {
 124   4              key_value=0;
 125   4              uart_printf("%Key1 times=%d\n",times);  
 126   4      //      uart_printf("Key1=S4\n");
 127   4            }
 128   3          }
 129   2          if(41==key_value){key_value=0;  uart_printf("Key2=S3\n");};   
 130   2          if(42==key_value){key_value=0;  uart_printf("Key3=S2\n");};   
 131   2          if(43==key_value){key_value=0;  uart_printf("Key4=S1\n");}; 
 132   2          if(ab == 0)
 133   2            {
 134   3              P32F = OUTPUT;          //P32设置为推挽输出模式 
 135   3              P32 = 1;
 136   3              ab = 1;
 137   3            }
 138   2            else
 139   2            {
 140   3              ab = 0;
 141   3              P32F = OUTPUT;          //P32设置为推挽输出模式 
 142   3              P32 = 0;
 143   3            }
 144   2      
 145   2          if(HalfSecFlag) //半秒打印当前时间
 146   2          {
 147   3            HalfSecFlag = 0;
 148   3        #ifdef PRINT_EN
 149   3            RTC_Get();
 150   3      //      uart_printf("%d-%d-%d %d:%d:%d ( %d )\n",calendar.w_year,calendar.w_month,calendar.w_date,calendar.ho
             -ur,calendar.min,calendar.sec,calendar.week);  
 151   3            a=calendar.w_year;
 152   3            b=calendar.w_month;   
 153   3            c=calendar.w_date;    
 154   3              d=calendar.week;
 155   3            e=calendar.hour;
 156   3            f=calendar.min;
 157   3            g=calendar.sec;
 158   3            uart_printf("%d/%d/%d-[%d]  %d:%d:%d\n",a,b,c,d,e,f,g); 
 159   3              
 160   3        #endif    
 161   3          }
 162   2      /*    
 163   2          if(AlarmEvFlag) //闹钟中断产生时打印
 164   2          {
 165   2            AlarmEvFlag = 0;
 166   2        #ifdef PRINT_EN
 167   2            uart_printf("Alarm event happen!\n"); 
 168   2        #endif    
 169   2          }
 170   2      */    
 171   2        }
 172   1      }
C51 COMPILER V9.60.0.0   MAIN                                                              06/24/2023 12:55:00 PAGE 4   

*** WARNING C280 IN LINE 35 OF source\main.c: 'i': unreferenced local variable
 173          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    445    ----
   CONSTANT SIZE    =    101    ----
   XDATA SIZE       =   ----      18
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
