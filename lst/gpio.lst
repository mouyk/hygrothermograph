C51 COMPILER V9.60.0.0   GPIO                                                              06/24/2023 12:55:00 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE GPIO
OBJECT MODULE PLACED IN .\output\gpio.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE source\gpio.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\include;.\sou
                    -rce;.\include) DEBUG PRINT(.\lst\gpio.lst) TABS(2) OBJECT(.\output\gpio.obj)

line level    source

   1          
   2          #ifndef _GPIO_C_
   3          #define _GPIO_C_
   4          /*********************************************************************************************************
             -************/
   5          #include "include/ca51f_config.h"   
   6          #include "include/ca51f2sfr.h"
   7          #include "include/ca51f2xsfr.h"
   8          #include "include/gpiodef_f2.h"
   9          #include "include/system_clock.h"
  10          
  11          #include "include/uart.h"
  12          #include "include/lcd_led.h"
  13          #include "include/delay.h"
  14          #include "include/lcd.h"
*** WARNING C318 IN LINE 14 OF source\gpio.c: can't open file 'include/lcd.h'
  15          #include "include/gpio.h"
  16          #include <intrins.h>
  17          /*********************************************************************************************************
             -************      
  18          
  19            P00F = OUTPUT;          //P00设置为推挽输出模式
  20            P00C |= 0x80;         //P00使能高灌电流模式
  21            
  22            P00F = INPUT|PU_EN;       //P00设置为输入模式并使能上拉电阻
  23            P00C |= 0x20;         //上拉电阻选择为强上拉
  24          //  P00C &= ~0x20;          //上拉电阻选择为弱上拉
  25          
  26            P00F = INPUT|PD_EN;       //P00设置为输入模式并使能下拉电阻
  27            P00C |= 0x10;         //下拉电阻选择为强下拉
  28          //  P00C &= ~0x10;          //下拉电阻选择为弱下拉
  29            
  30            P00F = P00_COM0_SETTING;    //P00设置为COM引脚功能
  31          
  32          **********************************************************************************************************
             -***********/  
  33          uint8_t key_value=0;
  34          //EPCON寄存器定义
  35          #define EPPL(N) (N<<7)
  36          /*****************************************************************************
  37           ** \brief   GPIO_Init  
  38                 GPIO_Init初始化GPIO函数,比如按键开光输入输出
  39           ** \param   [in] none       
  40           ** \return   none
  41          *****************************************************************************/
  42          void GPIO_init(void)
  43          {
  44   1      /*按键 上拉输入 P40 | S4  P41 | S3  P42 | S2  P43 | S1  */
  45   1        
  46   1        P40F = INPUT|PU_EN;       //P40设置为输入模式并使能上拉电阻 
  47   1        P40C |= 0x20;         //上拉电阻选择为强上拉
  48   1      //  P40C &= ~0x20;          //上拉电阻选择为弱上拉  
  49   1        
  50   1        P41F = INPUT|PU_EN;       //P41设置为输入模式并使能上拉电阻 
C51 COMPILER V9.60.0.0   GPIO                                                              06/24/2023 12:55:00 PAGE 2   

  51   1        P41C |= 0x20;         //上拉电阻选择为强上拉
  52   1      //  P41C &= ~0x20;          //上拉电阻选择为弱上拉  
  53   1        
  54   1        P42F = INPUT|PU_EN;       //P42设置为输入模式并使能上拉电阻 
  55   1        P42C |= 0x20;         //上拉电阻选择为强上拉
  56   1      //  P42C &= ~0x20;          //上拉电阻选择为弱上拉    
  57   1        
  58   1        P43F = INPUT|PU_EN;       //P43设置为输入模式并使能上拉电阻 
  59   1        P43C |= 0x20;         //上拉电阻选择为强上拉
  60   1      //  P43C &= ~0x20;          //上拉电阻选择为弱上拉    
  61   1        
  62   1      /*DCDC 开漏输出 P45 */
  63   1        P45F = OUTPUT|OP_EN;      //P45设置为开漏输出 
  64   1      //  P45C |= 0x20;         //上拉电阻选择为强上拉
  65   1      //  P45C &= ~0x20;          //上拉电阻选择为弱上拉  
  66   1        P45 = 0;            //P45输出置零 开启模组电源  
  67   1        
  68   1      /*充电检测。P46 充电插入检测，P47 充电状态检测*/
  69   1        P46F = INPUT|PU_EN;       //P46设置为输入模式并使能上拉电阻 
  70   1        P46C |= 0x20;         //上拉电阻选择为强上拉
  71   1      //  P46C &= ~0x20;          //上拉电阻选择为弱上拉  
  72   1        P47F = INPUT|PU_EN;       //P47设置为输入模式并使能上拉电阻 
  73   1      //  P47C |= 0x20;         //上拉电阻选择为强上拉
  74   1        P47C &= ~0x20;          //上拉电阻选择为弱上拉  
  75   1        
  76   1      /* 背光输出控制 P32*/ 
  77   1        P32F = OUTPUT;          //P32设置为推挽输出模式 
  78   1        P32  = 1;           //默认背光开启
  79   1      /* 蜂鸣器输出控制 P33 PWM*/ 
  80   1        P33F = P33_PWM6_SETTING;    //P33设置为PWM 输出模式
  81   1        P33  = 0;           //默认蜂鸣器关闭
  82   1        
  83   1        
  84   1        
  85   1        
  86   1      }
  87          
  88          /*****************************************************************************
  89           ** \brief   I2C_init 
  90                 I2C_init 温湿度接口初始化
  91           ** \param   [in] none       
  92           ** \return   none
  93          *****************************************************************************/
  94          void I2C_init(void)
  95          {
  96   1      /**********选择I2C端口************************************************************/
  97   1        I2CIOS = 0;
  98   1        P36F = P36_I2C_SDA_SETTING | PU_EN;
  99   1        P37F = P37_I2C_SCL_SETTING | PU_EN;   
 100   1      }
 101          
 102          /*****************************************************************************
 103           ** \brief   Zigbee_GPIO_init 
 104                 Zigbee_GPIO_init与模组管脚通讯pin脚
 105           ** \param   [in] none       
 106           ** \return   none
 107          *****************************************************************************/
 108          void Zigbee_GPIO_init(void)
 109          {
 110   1      /**********选择UART0端口************************************************************/
 111   1        #ifdef UART0_EN
                P31F = P31_UART0_RX_SETTING;
C51 COMPILER V9.60.0.0   GPIO                                                              06/24/2023 12:55:00 PAGE 3   

                P30F = P30_UART0_TX_SETTING;  
                #endif
 115   1      /*  P04 模组唤醒MCU P05  MCU唤醒模组  */
 116   1        P04F = INPUT;       //P04设置为输入模式
 117   1        P05F = OUTPUT|OP_EN;    //P05设置为开漏输出 
 118   1        P05  = 0;         //P05输出置零
 119   1      }
 120          
 121          
 122          /*外部中断2控制例程***************************************************************************************
             -*************/
 123          void INT2_Init(void)
 124          {
 125   1      //  P10F = INPUT;             //P10设置为输入模式
 126   1        INDEX = 0;                //EPCON为带索引的寄存器，设置INDEX=0 对应INT2
 127   1        EPCON = EPPL(1) | 32;         //设置P40为INT2中断引脚，下降沿触发
 128   1        INT2EN = 1;               //外部中断2中断使能
 129   1        EPIE |= 0x01;             //INT2中断使能
 130   1        key_value = 0;    
 131   1      }
 132          void INT2_ISR (void) interrupt 7
 133          {
 134   1        if(EPIF & 0x01)
 135   1        {
 136   2          EPIF = 0x01;
 137   2      //    int2_flag = 1;
 138   2          key_value =40;
 139   2        }
 140   1      }
 141          
 142          /*外部中断3控制例程***************************************************************************************
             -*************/
 143          void INT3_Init(void)
 144          {
 145   1      //  P11F = INPUT;             //P11设置为输入模式 
 146   1        INDEX = 1;                //INDEX为带索引的寄存器，设置INDEX=1 对应INT3
 147   1        EPCON = EPPL(1) | 33;         //设置P41为INT3中断引脚，下降沿触发   
 148   1        INT3EN = 1;               //外部中断3中断使能 
 149   1        EPIE |= 0x02;             //INT3中断使能
 150   1        key_value = 0;  
 151   1      }
 152          void INT3_ISR (void) interrupt 8
 153          {
 154   1        if(EPIF & 0x02)
 155   1        {
 156   2          EPIF = 0x02;  
 157   2        key_value = 41; 
 158   2        }
 159   1      }
 160          /*********************************************************************************************************
             -************/
 161          
 162          /*外部中断4控制例程***************************************************************************************
             -*************/
 163          void INT4_Init(void)
 164          {
 165   1      //  P12F = INPUT;             //P12设置为输入模式   
 166   1        INDEX = 2;                //INDEX为带索引的寄存器，设置INDEX=2 对应INT4
 167   1        EPCON = EPPL(1) | 34;         //设置P42为INT4中断引脚，下降沿触发       
 168   1        INT4EN = 1;               //外部中断4中断使能
 169   1        EPIE |= 0x04;             //INT4中断使能
 170   1        key_value = 0;  
C51 COMPILER V9.60.0.0   GPIO                                                              06/24/2023 12:55:00 PAGE 4   

 171   1      }
 172          void INT4_ISR (void) interrupt 9
 173          {
 174   1        if(EPIF & 0x04)
 175   1        {
 176   2          EPIF = 0x04;
 177   2        key_value = 42; 
 178   2        }
 179   1      }
 180          /*********************************************************************************************************
             -************/
 181          
 182          /*外部中断5控制例程***************************************************************************************
             -*************/
 183          void INT5_Init(void)
 184          {
 185   1      //  P13F = INPUT;             //P13设置为输入模式   
 186   1        INDEX = 3;                //INDEX为带索引的寄存器，设置INDEX=3 对应INT5
 187   1        EPCON = EPPL(1) | 35;         //设置P43为INT5中断引脚，下降沿触发   
 188   1        INT5EN = 1;               //外部中断5中断使能 
 189   1        EPIE |= 0x08;             //INT5中断使能
 190   1        key_value = 0;  
 191   1      }
 192          void INT5_ISR (void) interrupt 10
 193          {
 194   1        if(EPIF & 0x08)
 195   1        {
 196   2          EPIF = 0x08;  
 197   2        key_value = 43; 
 198   2        }
 199   1      }
 200          
 201          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    321    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      1    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
