C51 COMPILER V9.60.0.0   PROTOCOL                                                          07/09/2023 22:10:34 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE PROTOCOL
OBJECT MODULE PLACED IN .\output\protocol.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE mcu_sdk\protocol.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\include;
                    -.\source;.\include) DEBUG PRINT(.\lst\protocol.lst) TABS(2) OBJECT(.\output\protocol.obj)

line level    source

   1          /**
   2          * @file  protocol.c
   3          * @brief this file contains protocol analysis and construct response function when received zigbee module 
             -send message
   4          * @author qinlang
   5          * @date 2022.05.06
   6          * @par email:qinlang.chen@tuya.com
   7          * @copyright HANGZHOU TUYA INFORMATION TECHNOLOGY CO.,LTD
   8          * @par company
   9          * http://www.tuya.com
  10          */
  11          
  12          #include "zigbee.h"
  13          
  14          #include "include/ca51f_config.h"   
  15          #include "include/ca51f2sfr.h"
  16          #include "include/ca51f2xsfr.h"
  17          #include "include/gpiodef_f2.h"
  18          #include "include/system_clock.h"
  19          
  20          #include "include/uart.h"
  21          #include "include/lcd_led.h"
  22          #include "include/delay.h"
  23          //#include "include/lcd.h"
  24          #include "include/gpio.h"
  25          #include "include/gxhtc.h"
  26          #include "include/rtc.h"
  27          #include <intrins.h>
  28          #include "include/pwm.h"
  29          #include "include/adc.h"
  30          #include "mcu_sdk/zigbee.h"
  31          
  32          /******************************************************************************
  33                                          ç§»æ¤é¡»çŸ¥:
  34          1:MCUå¿…é¡»åœ¨whileä¸­ç›´æŽ¥è°ƒç”¨mcu_api.cå†…çš„zigbee_uart_service()å‡½æ•°
  35          2:ç¨‹åºæ­£å¸¸åˆå§‹åŒ–å®ŒæˆåŽ,å»ºè®®ä¸è¿›è¡Œå…³ä¸²å£ä¸­æ–­,å¦‚å¿…é¡»å…³ä¸­æ–­,å…³ä¸­æ–­æ—¶é—´å¿…é¡»çŸ
             -­,å…³ä¸­æ–­ä¼šå¼•èµ·ä¸²å£æ•°æ®åŒ…ä¸¢å¤±
  36          3:è¯·å‹¿åœ¨ä¸­æ–­/å®šæ—¶å™¨ä¸­æ–­å†…è°ƒç”¨ä¸ŠæŠ¥å‡½æ•°
  37          ******************************************************************************/
  38          /******************************************************************************
  39                                        ç¬¬ä¸€æ­¥:åˆå§‹åŒ–
  40          1:åœ¨éœ€è¦ä½¿ç”¨åˆ°zigbeeç›¸å…³æ–‡ä»¶çš„æ–‡ä»¶ä¸­include "zigbee.h"
  41          2:åœ¨MCUåˆå§‹åŒ–ä¸­è°ƒç”¨mcu_api.cæ–‡ä»¶ä¸­çš„zigbee_protocol_init()å‡½æ•°
  42          3:å°†MCUä¸²å£å•å­—èŠ‚å‘é€å‡½æ•°å¡«å…¥protocol.cæ–‡ä»¶ä¸­uart_transmit_outputå‡½æ•°å†…,å¹¶åˆ é™¤#error
  43          4:åœ¨MCUä¸²å£æŽ¥æ”¶å‡½æ•°ä¸­è°ƒç”¨mcu_api.cæ–‡ä»¶å†…çš„uart_receive_inputå‡½æ•°,å¹¶å°†æŽ¥æ”¶åˆ°çš„å­—èŠ‚ä
             -½œä¸ºå‚æ•°ä¼ å…¥
  44          5:å•ç‰‡æœºè¿›å…¥whileå¾ªçŽ¯åŽè°ƒç”¨mcu_api.cæ–‡ä»¶å†…çš„zigbee_uart_service()å‡½æ•°
  45          
  46          6:mcuä½•æ—¶å¼€å¯zigbeeæ¨¡å—é…ç½‘ï¼Œå½“zigbeeæ¨¡å—æŸ¥è¯¢åˆ°mcuçš„äº§å“ä¿¡æ¯ä¹‹åŽï¼Œæˆ–è€…zigbeeæ¨¡å
             -—å‘é€äº†å½“å‰ç½‘ç»œçŠ¶æ€
  47          ç»™åˆ°mcuï¼ŒæŸ¥è¯¢pidä¿¡æ¯ä¼šåœ¨ä¸Šç”µ5ç§’ä¹‹åŽå‘é€,å¯¹æŽ¥éƒ¨åˆ†zigbeeè€ç‰ˆæœ¬é€šç”¨å¯¹æŽ¥å›ºä»¶ä½ŽåŠ
             -Ÿè€—ç‰ˆæœ¬å°¤å…¶éœ€è¦æ³¨æ„ä¸è¦
  48          åœ¨ç¬¬ä¸€æ¬¡ç¡®è®¤æ³¢ç‰¹çŽ‡çš„æ—¶å€™æå‰å”¤é†’æˆ–è€…å‘é€ä¸²å£ç»™zigbeeæ¨¡ç»„ï¼Œæœ‰æ¦‚çŽ‡å¯¼è‡´zigbeeæ
             -¨¡ç»„æ³¢ç‰¹çŽ‡å­˜å‚¨å¤±è´¥ã€‚
C51 COMPILER V9.60.0.0   PROTOCOL                                                          07/09/2023 22:10:34 PAGE 2   

  49          
  50          7ï¼šä¸Šç”µä¹‹åŽï¼Œmcuä½•æ—¶ä¸ŠæŠ¥æ•°æ®ç»™ç½‘å…³åˆé€‚ï¼Œåœ¨æ”¶åˆ°ç½‘ç»œçŠ¶æ€ä¸ºå·²é…ç½‘ï¼Œæˆ–è€…æŽ¥æ”¶
             -åˆ°è¯»å–dpæ•°æ®çš„æ—¶å€™ã€‚
  51          8: åœ¨mcu otaè¿‡ç¨‹ä¸­å‘é€å›ºä»¶å†…å®¹è¯·æ±‚æœªæ”¶åˆ°zigbeeæ¨¡å—çš„åº”ç­”æ—¶ï¼Œéœ€è¦mcuç«¯åšå¥½è¶…æ—¶
             -é‡æ–°è¯·æ±‚çš„å¤„ç†ï¼Œå’Œå­˜å‚¨image
  52          å¤„ç†ï¼Œæ ¡éªŒå’Œå¯ä»¥è‡ªè¡Œè®¾è®¡æˆ–è€…ä½¿ç”¨å‚è€ƒã€‚
  53          ******************************************************************************/
  54          
  55          /******************************************************************************
  56                                  1:dpæ•°æ®ç‚¹åºåˆ—ç±»åž‹å¯¹ç…§è¡¨
  57                    **æ­¤ä¸ºè‡ªåŠ¨ç”Ÿæˆä»£ç ,å¦‚åœ¨å¼€å‘å¹³å°æœ‰ç›¸å…³ä¿®æ”¹è¯·é‡æ–°ä¸‹è½½MCU_SDK**         
  58          ******************************************************************************/
  59          
  60          ///> dp data list, this will be generated by cloud platform
  61          const DOWNLOAD_CMD_S download_cmd[] =
  62          {
  63            {DPID_TEMP_CURRENT, DP_TYPE_VALUE},
  64            {DPID_HUMIDITY_VALUE, DP_TYPE_VALUE},
  65            {DPID_BATTERY_PERCENTAGE, DP_TYPE_VALUE},
  66            {DPID_CHARGE_STATE, DP_TYPE_BOOL},
  67          };
  68          
  69          
  70          /******************************************************************************
  71                                     2:ä¸²å£å•å­—èŠ‚å‘é€å‡½æ•°
  72          è¯·å°†MCUä¸²å£å‘é€å‡½æ•°å¡«å…¥è¯¥å‡½æ•°å†…,å¹¶å°†æŽ¥æ”¶åˆ°çš„æ•°æ®ä½œä¸ºå‚æ•°ä¼ å…¥ä¸²å£å‘é€å‡½æ•°
  73          ******************************************************************************/
  74          
  75          static void report_mcu_ota_result(unsigned char  res);
  76          
  77          
  78          /**
  79          * @brief encapsulates a generic send function, developer should use their own function to completing this 
             -fuction 
  80          * @param[in] {value} send signle data 
  81          * @return  void
  82          */
  83          void uart_transmit_output(unsigned char value)
  84          {
  85   1      //  #error "please use your own uart send fuction complete this fuction, exmaple"
  86   1      /*
  87   1      *  //demo:
  88   1      *  extern void Uart_PutChar(unsigned char value);
  89   1      *  Uart_PutChar(value);                              
  90   1      */
  91   1      //  set_gpio_low();
  92   1      //  delay(1);
  93   1      //  set_gpio_high();
  94   1      //  uart_send_buffer();
  95   1        
  96   1        Uart0_PutChar(value); 
  97   1      //  TI0 = 0;
  98   1      //  S0BUF=value;
  99   1      //  ES0 = 1;
 100   1      }
*** WARNING C280 IN LINE 83 OF mcu_sdk\protocol.c: 'value': unreferenced local variable
 101          
 102          /******************************************************************************
 103                                     ç¬¬äºŒæ­¥:å®žçŽ°å…·ä½“ç”¨æˆ·å‡½æ•°
 104          1:APPä¸‹å‘æ•°æ®å¤„ç†
 105          2:æ•°æ®ä¸ŠæŠ¥å¤„ç†
 106          ******************************************************************************/
C51 COMPILER V9.60.0.0   PROTOCOL                                                          07/09/2023 22:10:34 PAGE 3   

 107          
 108          /******************************************************************************
 109                                      1:æ‰€æœ‰æ•°æ®ä¸ŠæŠ¥å¤„ç†
 110          å½“å‰å‡½æ•°å¤„ç†å…¨éƒ¨æ•°æ®ä¸ŠæŠ¥(åŒ…æ‹¬å¯ä¸‹å‘/å¯ä¸ŠæŠ¥å’Œåªä¸ŠæŠ¥)
 111            éœ€è¦ç”¨æˆ·æŒ‰ç…§å®žé™…æƒ…å†µå®žçŽ°:
 112            1:éœ€è¦å®žçŽ°å¯ä¸‹å‘/å¯ä¸ŠæŠ¥æ•°æ®ç‚¹ä¸ŠæŠ¥
 113            2:éœ€è¦å®žçŽ°åªä¸ŠæŠ¥æ•°æ®ç‚¹ä¸ŠæŠ¥
 114          æ­¤å‡½æ•°ä¸ºMCUå†…éƒ¨å¿…é¡»è°ƒç”¨
 115          ç”¨æˆ·ä¹Ÿå¯è°ƒç”¨æ­¤å‡½æ•°å®žçŽ°å…¨éƒ¨æ•°æ®ä¸ŠæŠ¥
 116          ******************************************************************************/
 117          
 118          //è‡ªåŠ¨åŒ–ç”Ÿæˆæ•°æ®ä¸ŠæŠ¥å‡½æ•°
 119          
 120          /**
 121          * @brief Upload all dp information of the system, and realize the synchronization of APP and muc data
 122          * @param[in] {void}
 123          * @return  void
 124          */
 125          void all_data_update(void)
 126          {
 127   1      //  #error "mcu must realize function internal function"
 128   1         /*
 129   1        * these fucntion will be generated by cloud platform, but when use these function must reference the fun
             -ction in  mcu_api.c
 130   1       */
 131   1        P05  = 0;         //P05è¾“å‡ºç½®é›¶ 
 132   1      //  Delay_50us(); 
 133   1      //  P05  = 1;         //P05è¾“å‡ºç½®é›¶   
 134   1          mcu_dp_value_update(DPID_TEMP_CURRENT,40); //VALUEåž‹æ•°æ®ä¸ŠæŠ¥;
 135   1          mcu_dp_value_update(DPID_HUMIDITY_VALUE,60); //VALUEåž‹æ•°æ®ä¸ŠæŠ¥;
 136   1      //    mcu_dp_value_update(DPID_BATTERY_PERCENTAGE,å½“å‰ç”µæ± ç”µé‡); //VALUEåž‹æ•°æ®ä¸ŠæŠ¥;
 137   1      //    mcu_dp_bool_update(DPID_CHARGE_STATE,å½“å‰å……ç”µçŠ¶æ€); //BOOLåž‹æ•°æ®ä¸ŠæŠ¥;
 138   1      
 139   1      }
 140          
 141          /******************************************************************************
 142                                          WARNING!!!    
 143                                      2:æ‰€æœ‰æ•°æ®ä¸ŠæŠ¥å¤„ç†
 144          è‡ªåŠ¨åŒ–ä»£ç æ¨¡æ¿å‡½æ•°,å…·ä½“è¯·ç”¨æˆ·è‡ªè¡Œå®žçŽ°æ•°æ®å¤„ç†
 145          ******************************************************************************/
 146          
 147          ///> this will realize by  cloud platform
 148          
 149          
 150          
 151          
 152          
 153          #ifdef SUPPORT_MCU_RTC_CHECK
              /**
              * @brief mcu check local RTC time 
              * @param[in] {time} timestamp
              * @return  void
              */
              void mcu_write_rtctime(unsigned char time[])
              {
                #error "mcu should realize RTC time wtriting fuction, and delete this line"
                /*
                time[0]~time[3]ï¼šstandard time
                time[4]~time[7]: Local time
               */
                my_memcpy((void *)timestamp,(const char *)time,4);  //get timestamp
                zigbee_timestamp_to_time(); 
C51 COMPILER V9.60.0.0   PROTOCOL                                                          07/09/2023 22:10:34 PAGE 4   

              /*
                year = _time.w_year;  //year
                month = _time.w_month;  //month
                date = _time.w_date;  //date
                hour = _time.hour + 8;  //hour(8:BeiJing time)
                min = _time.min;  //minute
                sec = _time.sec;  //second
              */
              }
              #endif
 178          
 179          
 180          /**
 181          * @brief Zigbee functional test feedback
 182          * @param[in] {void} 
 183          * @return  void
 184          */
 185          void zigbee_test_result(void)
 186          {
 187   1      //  #error "this test is makesure the rf fuction of zigbee module, if test pass or not should do something,
             - mcu should realize"
 188   1        unsigned char rssi = zigbee_uart_rx_buf[DATA_START+1];
 189   1      
 190   1        if(zigbee_uart_rx_buf[DATA_START]== 0x01){
 191   2          if(rssi > 0x3C) {
 192   3            //test sucess the range of rssi is 0% ~ 100%
 193   3          }
 194   2          else{
 195   3            //test failure
 196   3          }
 197   2        }
 198   1        else{
 199   2          //test failure
 200   2        }
 201   1      }
 202          
 203          /******************************************************************************
 204                                          WARNING!!!                     
 205          ä»¥ä¸‹å‡½æ•°ç”¨æˆ·è¯·å‹¿ä¿®æ”¹!!
 206          ******************************************************************************/
 207          
 208          /**
 209          * @brief this function will handle uart received frame data  
 210          * @param[in] {dpid}   dp id
 211          * @param[in] {value}  dp data 
 212          * @param[in] {length} lenght of dp data 
 213          * @return  handle result 
 214          */
 215          unsigned char dp_download_handle(unsigned char dpid,const unsigned char value[], unsigned short length)
 216          {
 217   1        /* only list of function, mcu need realize these fuction*/
 218   1        unsigned char ret;
 219   1        switch(dpid){
 220   2        
 221   2        
 222   2        default:
 223   2          break;
 224   2        }
 225   1        return ret;
 226   1      }
*** WARNING C280 IN LINE 215 OF mcu_sdk\protocol.c: 'value': unreferenced local variable
*** WARNING C280 IN LINE 215 OF mcu_sdk\protocol.c: 'length': unreferenced local variable
C51 COMPILER V9.60.0.0   PROTOCOL                                                          07/09/2023 22:10:34 PAGE 5   

 227          
 228          /**
 229          * @brief get received cmd total number
 230          * @param[in] {void}   
 231          * @return  received cmd total number
 232          */
 233          unsigned char get_download_cmd_total(void)
 234          {
 235   1        return(sizeof(download_cmd) / sizeof(download_cmd[0]));
 236   1      }
 237          
 238          
 239          /**
 240          * @brief received zigbee net_work state handle 
 241          * @param[in] {zigbee_work_state}  zigbee current network state
 242          * @return  void 
 243          */
 244          void zigbee_work_state_event(unsigned char zigbee_work_state)
 245          { 
 246   1        unsigned short length= 0;
 247   1        zigbee_uart_write_frame(ZIGBEE_STATE_CMD, length);  
 248   1      
 249   1        switch(zigbee_work_state){
 250   2          case ZIGBEE_NOT_JION: 
 251   2            #ifdef PRINT_EN
 252   2              uart_printf("ZIGBEE_NOT_JION\n");
 253   2            #endif    
 254   2            break;
 255   2          
 256   2          case ZIGBEE_JOIN_GATEWAY: 
 257   2            #ifdef PRINT_EN
 258   2              uart_printf("ZIGBEE_JOIN_GATEWAY\n");
 259   2            #endif  
 260   2            break;
 261   2          
 262   2          case ZIGBEE_JOIN_ERROR: 
 263   2            #ifdef PRINT_EN
 264   2              uart_printf("ZIGBEE_JOIN_ERROR\n");
 265   2            #endif  
 266   2            break;
 267   2          
 268   2          case ZIGBEE_JOINING:  
 269   2            #ifdef PRINT_EN
 270   2              uart_printf("ZIGBEE_JOINING\n");
 271   2            #endif  
 272   2            break;
 273   2          
 274   2          default:
 275   2            break;
 276   2        }
 277   1      }
 278          
 279          
 280          /**
 281          * @brief received reset zigbee response 
 282          * @param[in] {state} response state 
 283          * @return  void 
 284          */
 285          void mcu_reset_zigbee_event(unsigned char state)
 286          { 
 287   1        switch(state){
 288   2          case RESET_ZIGBEE_OK:
C51 COMPILER V9.60.0.0   PROTOCOL                                                          07/09/2023 22:10:34 PAGE 6   

 289   2          
 290   2            break;
 291   2          
 292   2          case RESET_ZIGBEE_ERROR:
 293   2          
 294   2            break;
 295   2          
 296   2          default:
 297   2            break;
 298   2        }
 299   1      }
 300          
 301          
 302          /**
 303          * @brief check mcu version response
 304          * @param[in] {void}
 305          * @return  void 
 306          */
 307          void response_mcu_ota_version_event(void)
 308          {
 309   1        unsigned short length = 0;
 310   1        length = set_zigbee_uart_byte(length,get_current_mcu_fw_ver()); //current fw version
 311   1        zigbee_uart_write_frame(MCU_OTA_VERSION_CMD,length);
 312   1      }
 313          
 314          #ifdef SUPPORT_MCU_OTA
              /**
              * @brief mcu ota update notify response
              * @param[in] {offset} data offset 
              * @return  void 
              */
              void response_mcu_ota_notify_event(unsigned char offset)
              {
                unsigned char i = 0;
                unsigned short length = 0;
                
                current_mcu_fw_pid(); //current PID
                
                while(i<8){
                  ota_fw_info.mcu_ota_pid[i] = zigbee_uart_rx_buf[offset + DATA_START + i];               //ota fw PID
                  i++;
                }
                ota_fw_info.mcu_ota_ver = zigbee_uart_rx_buf[offset + DATA_START + 8];                      //ota fw version
                ota_fw_info.mcu_ota_fw_size = zigbee_uart_rx_buf[offset + DATA_START + 9] << 24 | \
                                              zigbee_uart_rx_buf[offset +DATA_START + 10] << 16 | \
                                              zigbee_uart_rx_buf[offset + DATA_START + 11] << 8 | \
                                              zigbee_uart_rx_buf[offset + DATA_START + 12];               //ota fw size
                ota_fw_info.mcu_ota_checksum = zigbee_uart_rx_buf[offset + DATA_START + 13] << 24 | \
                                               zigbee_uart_rx_buf[offset + DATA_START + 14] << 16 | \
                                               zigbee_uart_rx_buf[offset + DATA_START + 15] << 8 | \
                                               zigbee_uart_rx_buf[offset + DATA_START + 16];                //ota fw checksum
                
                if((!strcmp_barry(&ota_fw_info.mcu_ota_pid[0],&current_mcu_pid[0],8)) && \
                   (ota_fw_info.mcu_ota_ver > get_current_mcu_fw_ver() &&\
                    ota_fw_info.mcu_ota_fw_size > 0)  
                  ){    //check fw pid and fw version and fw size
                  length = set_zigbee_uart_byte(length,0x00); //OK
                }
                else{
                  length = set_zigbee_uart_byte(length,0x01); //error
                }
                  ota_fw_info.mcu_current_offset = 0;
C51 COMPILER V9.60.0.0   PROTOCOL                                                          07/09/2023 22:10:34 PAGE 7   

                zigbee_uart_write_frame(MCU_OTA_NOTIFY_CMD,length);
              }
              
              
              /**
              * @brief received mcu ota data request response
              * @param[in] {fw_offset}  offset of file 
              * @param[in] {data}  received data  
              * @return  void 
              */
              void reveived_mcu_ota_data_handle(unsigned int fw_offset,char *data)
              {
                #error "received frame data, should save in flash, mcu should realize this fuction, and delete this line 
             -"
              }
              
              /**
              * @brief mcu send ota data request 
              * @param[in] {void}  
              * @return  void 
              */
              void mcu_ota_fw_request_event(unsigned char offset)
              { 
                unsigned int fw_offset = 0;
                char fw_data[FW_SINGLE_PACKET_SIZE] = {-1}; //
                unsigned char i = 0;
                unsigned char last_package_len = 0;
                static unsigned int current_checksum = 0;
              
                if(zigbee_uart_rx_buf[offset + DATA_START] == 0x01)       //status check
                  return;
                while(i < 8){
                  if(current_mcu_pid[i] != zigbee_uart_rx_buf[offset + DATA_START + 1 + i]) //pid check
                    return;
                  i++;
                }
                if(ota_fw_info.mcu_ota_ver != zigbee_uart_rx_buf[offset + DATA_START + 9]) //version check
                  return;
                
                i = 0;
                while(i < 4){
                  fw_offset |= (zigbee_uart_rx_buf[offset + DATA_START + 10 + i] << (24 - i * 8));    //offset
                  i++;
                }
                i = 0;
                if(ota_fw_info.mcu_current_offset ==  fw_offset)
                {
                  if((ota_fw_info.mcu_ota_fw_size - fw_offset) / FW_SINGLE_PACKET_SIZE != 0){
                    if(ota_fw_info.mcu_current_offset == 0){
                      current_checksum = 0;
                    }
                    while(i < FW_SINGLE_PACKET_SIZE){
                      fw_data[i] = zigbee_uart_rx_buf[offset + DATA_START + 14 + i];   //fw data
                      current_checksum += fw_data[i];
                      i++;
                    }
                    ota_fw_info.mcu_current_offset += FW_SINGLE_PACKET_SIZE;
                    ota_fw_data_handle(fw_offset,&fw_data[0],FW_SINGLE_PACKET_SIZE);  //OTA paket data handle
                  }
                  else {
                    i = 0;
                    last_package_len = ota_fw_info.mcu_ota_fw_size - fw_offset;
C51 COMPILER V9.60.0.0   PROTOCOL                                                          07/09/2023 22:10:34 PAGE 8   

                    while(i < last_package_len){
                      fw_data[i] = zigbee_uart_rx_buf[offset + DATA_START + 14 + i];
                      current_checksum += fw_data[i];
                      i++;
                    }
                    ota_fw_info.mcu_current_offset += last_package_len;
                    if(ota_fw_info.mcu_ota_checksum != current_checksum){
                      //ota failure report ota failure and clear ota struct 
                      mcu_ota_result_report(1); // failed
                    } 
                    else{
                      //ota sucess 
                      mcu_ota_result_report(0); // seccess
                    }
                    ota_fw_data_handle(fw_offset,&fw_data[0],last_package_len); //OTA paket data handle   
                    current_checksum = 0;                             
                  }
                }
                else
                {
                  // ota request timeout, then restart ota request from  ota_fw_info.mcu_ota_fw_size
                }
              }
              
              static void report_mcu_ota_result(unsigned char  res)
              {
                unsigned short length;
                if((res==0)||(res == 1))
                {
                  length = set_zigbee_uart_byte(length,res);  
                  zigbee_uart_write_frame(MCU_OTA_NOTIFY_CMD,length);
                }
              }
              
              
              /**
              * @brief mcu ota data result notify
              * @param[in] {void} 
              * @return  void 
              */
              void mcu_ota_result_event(unsigned char offset)
              {
                unsigned char status = zigbee_uart_rx_buf[offset + DATA_START];
                
                if(status == 0x00){
                }
                else if(status == 0x01) {
              
                }
              }
              
              /**
              * @brief mcu ota data handle 
              * @param[in] {fw_offset} frame offset 
              * @param[in] {data} received data
              * @return  void 
              */
              void ota_fw_data_handle(unsigned int fw_offset,char *data,unsigned char data_len)
              {
                #error "è¯·åœ¨è¯¥å‡½æ•°å¤„ç†å›ºä»¶åŒ…æ•°æ®,å¹¶åˆ é™¤è¯¥è¡Œ"
              }
              #endif
C51 COMPILER V9.60.0.0   PROTOCOL                                                          07/09/2023 22:10:34 PAGE 9   

 474          
 475          
 476          #ifdef  BEACON_TEST
              /**
              * @brief beacon test notify,which used in testing
              * @param[in] {void} 
              * @return  void 
              */
              void mcu_received_beacon_test_handle(void)
              {
                unsigned short length = 0;
                length = set_zigbee_uart_byte(length,0x00); 
                zigbee_uart_write_frame(SEND_BEACON_NOTIFY_CMD,length);
                // then start test
              }
              #endif
 490          
 491          #ifdef  CHECK_ZIGBEE_NETWORK
              /**
              * @brief check zigbee nwkstate,before start join nwk, check nwk if state is not 0x02,can start jion,
              * else delay 5s 
              *
              * @param[in] {void} 
              * @return  void 
              */
              void mcu_check_zigbee_nwk_state(void)
              {
                unsigned short length = 0;
                zigbee_uart_write_frame(CHECK_ZIGBEE_NETWORK_CMD,length);
                // then start test
              }
              #endif
 506          
 507          void zigbee_notify_factory_new_hanlde(void)
 508          {
 509   1        unsigned short length = 0;
 510   1        length = set_zigbee_uart_byte(length,0x01); 
 511   1        zigbee_uart_write_frame(ZIGBEE_FACTORY_NEW_CMD,length);
 512   1        // then start test
 513   1      }
 514          
 515          
 516          #ifdef READ_DP_DATA_NOTIFY
              /**
              * @brief when gateway repower or relink clould, or zigbee module join sucess, repower, this commod will no
             -tify 
              * mcu, to sys dp data, mcu itself decide whether report.
              *
              * @param[in] {void} 
              * @return  void 
              */
              void read_dp_data_notify_hanlde(void)
              {
                unsigned short length = 0;
                length = set_zigbee_uart_byte(length,0x01); 
                zigbee_uart_write_frame(ZIGBEE_FACTORY_NEW_CMD,length);
                // then start test
              }
              #endif 
 532          
 533          
 534          
C51 COMPILER V9.60.0.0   PROTOCOL                                                          07/09/2023 22:10:34 PAGE 10  

*** WARNING C316 IN LINE 534 OF mcu_sdk\protocol.c: unterminated conditionals


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    192    ----
   CONSTANT SIZE    =     73    ----
   XDATA SIZE       =      8      12
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  4 WARNING(S),  0 ERROR(S)
